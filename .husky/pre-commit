
echo "ğŸ§‘â€ğŸ’» Running lint-staged..."
npx lint-staged

STATUS=$?
if [ "$STATUS" -eq 0 ]; then
  echo "ğŸ‰ No errors found. Let it go... ğŸš€"
  exit 0 
elif [ "$STATUS" -eq 1 ]; then
  echo "ğŸ‘®â€â™‚ï¸ Commit blocked: Lint errors found in staged files ğŸš¨"
  echo "ğŸ› ï¸ Fix them before committing ğŸ¤–"
  exit 1
else
  echo "ğŸ’¥ Unexpected error: Something went wrong"
  exit $STATUS
fi


# Get staged .spec.ts or .test.ts files
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(spec|test)\.ts$')

if [ -n "$FILES" ]; then
  # Search for `.only` in those test files
  MATCHED=$(echo "$FILES" | xargs grep -n '\.only' || true)

  if [ -n "$MATCHED" ]; then
    echo "$MATCHED"
    echo "ğŸ‘®â€â™‚ï¸  Commit blocked: Remove '.only' in test files before commit ğŸš¨"
    exit 1
  fi
fi
