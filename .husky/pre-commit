#!/bin/sh

echo "ğŸ§‘â€ğŸ’» Running lint-staged..."
npx lint-staged

STATUS=$?
if [ "$STATUS" -eq 1 ]; then
  echo "ğŸ‘®â€â™‚ï¸ Commit blocked: Lint errors found in staged files ğŸš¨"
  echo "ğŸ› ï¸ Fix them before committing ğŸ¤–"
  exit 1
elif [ "$STATUS" -ne 0 ]; then
  echo "ğŸ’¥ Unexpected error from lint-staged"
  exit $STATUS
fi

MATCHED=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(spec|test)\.ts$' | xargs grep -n '\.only' 2>/dev/null || true)

if [ -n "$MATCHED" ]; then
  echo "$MATCHED"
  echo "ğŸ‘®â€â™‚ï¸ Commit blocked: Remove '.only' in test files before commit ğŸš¨"
  exit 1
fi

echo "ğŸ‰ No errors found. Let it go... ğŸš€"
exit 0